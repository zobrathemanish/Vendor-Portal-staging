<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FGI â€“ Single Product Entry</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background-color: #f5f5f5; font-family: 'Segoe UI', Arial, sans-serif; }
    .card { border-radius: 12px; }
    .accordion-button { font-weight: 600; }
    .btn-primary { background-color: #C8102E; border: none; }
    .btn-primary:hover { background-color: #a00d25; }
    .form-label { font-weight: 500; }
  </style>
</head>
<body>

<div class="container my-5">
  <div class="card shadow-sm p-4">

    <div class="text-center mb-4">
      <img src="{{ url_for('static', filename='fgi_logo.png') }}" alt="FGI Logo" height="40" class="mb-2">
      <h3 class="fw-bold">Single Product Submission</h3>
      <p class="text-muted mb-0">Enter product details using FGIâ€™s standardized structure</p>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('submit_single_product') }}">

      <!-- Core info -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Vendor</label>
          <select class="form-select" name="vendor_name" required>
            <option value="">-- Select Vendor --</option>
            {% for v in VENDOR_LIST %}
              <option value="{{ v }}" {% if v == vendor_prefill %}selected{% endif %}>{{ v }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 mb-3">
          <label class="form-label">Part Number (SKU) *</label>
          <input type="text" class="form-control" name="sku" required>
        </div>

        <div class="col-md-3 mb-3">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="change_type">
            <option value="">-- Select --</option>
            {% for c in CHANGE_TYPES %}
              <option value="{{ c }}" {% if c == change_prefill %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
          <small class="text-muted">A = Add, M = Modify, D = Delete</small>
        </div>
      </div>

      <div class="accordion" id="singleProductAccordion">

        <!-- Item Master -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingItemMaster">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseItemMaster">
              Item Master
            </button>
          </h2>
          <div id="collapseItemMaster" class="accordion-collapse collapse show" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Brand Code (if applicable)</label>
                  <input type="text" class="form-control" name="item_brand_code">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Brand Name</label>
                  <input type="text" class="form-control" name="item_brand_name">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">UNSPSC Code (optional)</label>
                  <input type="text" class="form-control" name="item_unspsc" maxlength="8">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Hazardous Material (Y/N)</label>
                  <select class="form-select" name="item_hazmat_flag">
                    <option value="">-- Select --</option>
                    {% for h in HAZMAT_OPTIONS %}
                      <option value="{{ h }}">{{ h }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Product Status</label>
                  <select class="form-select" name="item_status">
                    <option value="">-- Select --</option>
                    {% for s in LIFECYCLE_STATUS %}
                      <option value="{{ s }}">{{ s }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Barcode Type</label>
                  <select class="form-select" name="item_gtin_type">
                    <option value="">-- Select --</option>
                    {% for g in GTIN_TYPES %}
                      <option value="{{ g }}">{{ g }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Barcode Number (UPC/EAN)</label>
                  <input type="text" class="form-control" name="item_gtin" maxlength="14">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Has Applications / Fitments</label>
                  <select class="form-select" name="item_application_flag">
                    <option value="">-- Select --</option>
                    {% for a in APPLICATION_FLAG %}
                      <option value="{{ a }}">{{ a }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quantity Size</label>
                  <input type="text" class="form-control" name="item_quantity_size">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quantity Unit</label>
                  <select class="form-select" name="item_quantity_uom">
                    <option value="">-- Select --</option>
                    {% for u in QUANTITY_UOM %}
                      <option value="{{ u }}">{{ u }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Packaging Type</label>
                  <select class="form-select" name="item_packaging_type">
                    <option value="">-- Select --</option>
                    {% for p in PACKAGING_TYPES %}
                      <option value="{{ p }}">{{ p }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Weight</label>
                  <input type="text" class="form-control" name="item_weight">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Weight Unit</label>
                  <select class="form-select" name="item_weight_uom">
                    <option value="">-- Select --</option>
                    {% for w in WEIGHT_UOM %}
                      <option value="{{ w }}">{{ w }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Descriptions -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingDescriptions">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDescriptions">
              Descriptions
            </button>
          </h2>
          <div id="collapseDescriptions" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Description Type</label>
                  <select class="form-select" name="desc_type">
                    <option value="">-- Select --</option>
                    {% for d in DESCRIPTION_TYPES %}
                      <option value="{{ d }}">{{ d }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Sequence</label>
                  <input type="text" class="form-control" name="desc_sequence">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Language</label>
                  <select class="form-select" name="desc_language">
                    <option value="">-- Select --</option>
                    {% for lang in LANGUAGES %}
                      <option value="{{ lang }}">{{ lang }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="desc_text" rows="2"></textarea>
              </div>

            </div>
          </div>
        </div>

        <!-- Attributes -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingAttributes">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAttributes">
              Attributes
            </button>
          </h2>
          <div id="collapseAttributes" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Attribute Name (e.g., Height, Material)</label>
                  <input type="text" class="form-control" name="attr_feature_name">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Is Primary Attribute (Y/N)</label>
                  <select class="form-select" name="attr_is_primary">
                    <option value="">-- Select --</option>
                    <option value="Y">Y</option>
                    <option value="N">N</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Attribute Value</label>
                  <input type="text" class="form-control" name="attr_feature_value">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Unit of Measure (optional)</label>
                  <input type="text" class="form-control" name="attr_uom">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Attribute Order</label>
                  <input type="text" class="form-control" name="attr_order">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Language</label>
                  <select class="form-select" name="attr_language">
                    <option value="">-- Select --</option>
                    {% for lang in LANGUAGES %}
                      <option value="{{ lang }}">{{ lang }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Alternate Parts -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingAlternateParts">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAlternateParts">
              Alternate Parts
            </button>
          </h2>
          <div id="collapseAlternateParts" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Alternate Brand Code</label>
                  <input type="text" class="form-control" name="alt_brand_code">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Alternate Brand Name</label>
                  <input type="text" class="form-control" name="alt_brand_name">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Alternate Part Number</label>
                  <input type="text" class="form-control" name="alt_part_number">
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Alternate Unit of Measure</label>
                  <select class="form-select" name="alt_uom">
                    <option value="">-- Select --</option>
                    {% for u in ALT_UOM %}
                      <option value="{{ u }}">{{ u }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Interchange Quality</label>
                  <input type="text" class="form-control" name="alt_interchange_quality">
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Packaging -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingPackaging">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePackaging">
              Packaging
            </button>
          </h2>
          <div id="collapsePackaging" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Packaging Unit</label>
                  <select class="form-select" name="pack_uom">
                    <option value="">-- Select --</option>
                    {% for p in PACKAGING_TYPES %}
                      <option value="{{ p }}">{{ p }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Units Per Pack</label>
                  <input type="text" class="form-control" name="pack_qty_each">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Dimension Unit</label>
                  <select class="form-select" name="pack_dim_uom">
                    <option value="">-- Select --</option>
                    {% for d in DIMENSION_UOM %}
                      <option value="{{ d }}">{{ d }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Height</label>
                  <input type="text" class="form-control" name="pack_height">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Width</label>
                  <input type="text" class="form-control" name="pack_width">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Length</label>
                  <input type="text" class="form-control" name="pack_length">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Weight</label>
                  <input type="text" class="form-control" name="pack_weight">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Weight UOM</label>
                  <select class="form-select" name="pack_weight_uom">
                    <option value="">-- Select --</option>
                    {% for w in WEIGHT_UOM %}
                      <option value="{{ w }}">{{ w }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Barcode (GTIN)</label>
                  <input type="text" class="form-control" name="pack_gtin">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Package Barcode Type</label>
                  <select class="form-select" name="pack_gtin_type">
                    <option value="">-- Select --</option>
                    {% for g in GTIN_TYPES %}
                      <option value="{{ g }}">{{ g }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Media Assets -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingMediaAssets">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMediaAssets">
              Media Assets
            </button>
          </h2>
          <div id="collapseMediaAssets" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Media Type</label>
                  <select class="form-select" name="media_type">
                    <option value="">-- Select --</option>
                    {% for m in MEDIA_TYPES %}
                      <option value="{{ m }}">{{ m }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">File Name</label>
                  <input type="text" class="form-control" name="media_file_name">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">File URL or Location</label>
                  <input type="text" class="form-control" name="media_file_url">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">File Format</label>
                  <select class="form-select" name="media_file_format">
                    <option value="">-- Select --</option>
                    {% for f in FILE_FORMATS %}
                      <option value="{{ f }}">{{ f }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Color Mode</label>
                  <select class="form-select" name="media_color_mode">
                    <option value="">-- Select --</option>
                    {% for c in COLOR_MODES %}
                      <option value="{{ c }}">{{ c }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Color (optional)</label>
                  <input type="text" class="form-control" name="media_color">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Resolution (DPI or px)</label>
                  <input type="text" class="form-control" name="media_resolution">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Height</label>
                  <input type="text" class="form-control" name="media_height">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Width</label>
                  <input type="text" class="form-control" name="media_width">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Dimension Unit</label>
                  <select class="form-select" name="media_uom">
                    <option value="">-- Select --</option>
                    <option value="PX">PX</option>
                    <option value="IN">IN</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Media Date Type</label>
                  <select class="form-select" name="media_date_type">
                    <option value="">-- Select --</option>
                    {% for t in MEDIA_DATE_TYPES %}
                      <option value="{{ t }}">{{ t }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Media Date</label>
                  <input type="date" class="form-control" name="media_date">
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Pricing -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingPricing">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePricing">
              Pricing
            </button>
          </h2>
          <div id="collapsePricing" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Vendor Cost</label>
                  <input type="text" class="form-control" name="price_vendor_cost">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Price List Cost</label>
                  <input type="text" class="form-control" name="price_list_cost">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">EHC (Environmental Handling Cost)</label>
                  <input type="text" class="form-control" name="price_ehc">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Currency</label>
                  <select class="form-select" name="price_currency">
                    <option value="">-- Select --</option>
                    {% for cur in CURRENCIES %}
                      <option value="{{ cur }}">{{ cur }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Effective Date</label>
                  <input type="date" class="form-control" name="price_effective_date">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quote Cost</label>
                  <input type="text" class="form-control" name="price_quote_cost">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quote Usage</label>
                  <input type="text" class="form-control" name="price_quote_usage">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quote Start Date</label>
                  <input type="date" class="form-control" name="price_quote_start">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quote End Date</label>
                  <input type="date" class="form-control" name="price_quote_end">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Tender Cost</label>
                  <input type="text" class="form-control" name="price_tender_cost">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Tender Number</label>
                  <input type="text" class="form-control" name="price_tender_number">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Tender Start Date</label>
                  <input type="date" class="form-control" name="price_tender_start">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Tender End Date</label>
                  <input type="date" class="form-control" name="price_tender_end">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Promotional Price</label>
                  <input type="text" class="form-control" name="price_promo_price">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Promo Start Date</label>
                  <input type="date" class="form-control" name="price_promo_start">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Promo End Date</label>
                  <input type="date" class="form-control" name="price_promo_end">
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Core Part Numbers</label>
                  <input type="text" class="form-control" name="price_core_part_numbers">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Core Cost</label>
                  <input type="text" class="form-control" name="price_core_cost">
                </div>
              </div>

            </div>
          </div>
        </div>

      </div> <!-- /accordion -->

      <!-- Buttons -->
      <div class="d-flex flex-column flex-md-row gap-2 mt-4">
        <button type="submit" name="action" value="add" class="btn btn-secondary w-100 w-md-50">
          âž• Add Product to Batch
        </button>
        <button type="submit" name="action" value="generate" class="btn btn-primary w-100 w-md-50">
          ðŸ“Š Generate Excel for All Products
        </button>
      </div>

      <div class="text-center mt-3">
        <a href="{{ url_for('upload_page') }}" class="text-decoration-none">â¬… Back to Bulk Upload Portal</a>
      </div>

      {% if pending_products %}
        <hr class="my-4">
        <h5>Products Pending in Batch:</h5>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Brand</th>
                <th>Vendor</th>
                <th>Change Type</th>
              </tr>
            </thead>
            <tbody>
              {% for p in pending_products %}
                <tr>
                  <td>{{ p.get("sku") }}</td>
                  <td>{{ p.get("item_brand_name") }}</td>
                  <td>{{ p.get("vendor_name") }}</td>
                  <td>{{ p.get("change_type") }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}

      {% if latest_excel_available %}
        <div class="mt-3 text-center">
          <a href="{{ url_for('download_single_products_excel') }}" class="btn btn-outline-primary">
            â¬‡ Download Last Generated Excel
          </a>
        </div>
      {% endif %}

    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
