<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FGI â€“ Single Product Entry</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">



  <style>
    body { background-color: #f5f5f5; font-family: 'Segoe UI', Arial, sans-serif; }
    .card { border-radius: 12px; }
    .accordion-button { font-weight: 600; }
    .btn-primary { background-color: #C8102E; border: none; }
    .btn-primary:hover { background-color: #a00d25; }
    .form-label { font-weight: 500; }
    .section-heading { font-weight: 600; font-size: 1.05rem; }
    .small-help { font-size: 0.8rem; color: #777; }
  </style>
</head>

<body>

<div class="container my-5">
  <div class="card shadow-sm p-4">

    <div class="text-center mb-4">
      <img src="{{ url_for('static', filename='fgi_logo.png') }}" alt="FGI Logo" height="40" class="mb-2">
      <h3 class="fw-bold">Single Product Submission</h3>
      <p class="text-muted mb-0">FGI Standardized Structure â€“ Item, Descriptions, Extended Info, Attributes, Interchange, Packages, Assets, Pricing</p>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form id="singleProductForm"
          method="POST"
          action="{{ url_for('submit_single_product') }}"
          enctype="multipart/form-data">

      <!-- MAIN ACCORDION -->
      <div class="accordion mb-3" id="singleProductAccordion">

        <!-- SECTION 1 â€“ ITEM MASTER -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingItemMaster">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseItemMaster">
              SECTION 1 â€“ Item Master
            </button>
          </h2>
          <div id="collapseItemMaster" class="accordion-collapse collapse show" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Vendor</label>
                  <select class="form-select" name="vendor_name" required>
                    <option value="">-- Select Vendor --</option>
                    {% for v in VENDOR_LIST %}
                      <option value="{{ v }}" {% if v == vendor_prefill %}selected{% endif %}>{{ v }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Part Number (SKU) *</label>
                  <input type="text" class="form-control" name="sku" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">UNSPSC Code</label>
                  <input type="text"
                         class="form-control"
                         name="unspsc_code"
                         maxlength="8"
                         placeholder="8 digits">
                  <div class="small-help">Must be 8 digits if provided.</div>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Hazardous Material</label>
                  <select class="form-select" name="hazmat_flag">
                    <option value="">-- Select --</option>
                    <option value="Y">Y</option>
                    <option value="N">N</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Product Status</label>
                  <select class="form-select" name="product_status">
                    <option value="">-- Select --</option>
                    {% for s in PRODUCT_STATUS %}
                      <option value="{{ s }}">{{ s }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Barcode Type</label>
                  <select class="form-select" name="barcode_type" id="barcode_type">
                    <option value="">-- Select --</option>
                    <option value="UPC">UPC</option>
                    <option value="EAN">EAN</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Barcode Number</label>
                  <input type="text"
                         class="form-control"
                         name="barcode_number"
                         id="barcode_number"
                         maxlength="14"
                         placeholder="UPC 12 digits / EAN 14 digits">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">VMRS Code</label>
                  <input type="text" class="form-control" name="vmrs_code">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quantity Size Unit</label>
                  <select class="form-select" name="quantity_uom">
                    <option value="">-- Select --</option>
                    {% for u in QUANTITY_UOM %}
                      <option value="{{ u }}">{{ u }}</option>
                    {% endfor %}
                  </select>
                  <div class="small-help">e.g., EA, CS, PL</div>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Quantity Size</label>
                  <input type="text" class="form-control" name="quantity_size">
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- SECTION 2 â€“ DESCRIPTIONS -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingDescriptions">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDescriptions">
              SECTION 2 â€“ Descriptions
            </button>
          </h2>
          <div id="collapseDescriptions" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">
              <div id="descriptionsContainer"></div>
              <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addDescriptionBtn">
                + Add Description
              </button>
              <div class="small-help mt-1">
                DES / SHO descriptions should be less than 40 characters.
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION 3 â€“ EXTENDED PRODUCT INFO -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingExtendedInfo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExtendedInfo">
              SECTION 3 â€“ Extended Product Info
            </button>
          </h2>
          <div id="collapseExtendedInfo" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">
              <p class="small-help mb-2">
                Codes such as COO (Country of Origin), HSB (HS/Tariff â€“ 10 digits), LIF, LIS, MSR, NPC, PLC, PLM, TAX.
              </p>
              <div id="extendedInfoContainer"></div>
              <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addExtendedInfoBtn">
                + Add Extended Info
              </button>
            </div>
          </div>
        </div>

        <!-- SECTION 4 â€“ ATTRIBUTES -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingAttributes">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAttributes">
              SECTION 4 â€“ Attributes
            </button>
          </h2>
          <div id="collapseAttributes" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">
              <p class="small-help mb-2">
                Attribute examples: Height, Width, Material, Bolt Size, etc.
              </p>
              <div id="attributesContainer"></div>
              <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addAttributeBtn">
                + Add Attribute
              </button>
            </div>
          </div>
        </div>

        <!-- SECTION 5 â€“ PART INTERCHANGE -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingInterchange">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInterchange">
              SECTION 5 â€“ Part Interchange Info
            </button>
          </h2>
          <div id="collapseInterchange" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">
              <div id="interchangeContainer"></div>
              <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addInterchangeBtn">
                + Add Part Interchange
              </button>
              <div class="small-help mt-1">
                Interchange Quality Levels: A â€“ Exact, B â€“ Good, C â€“ Compatible, S â€“ Superseded.
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION 6 â€“ PACKAGES -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingPackages">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePackages">
              SECTION 6 â€“ Packages
            </button>
          </h2>
          <div id="collapsePackages" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">
              <div id="packagesContainer"></div>
              <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addPackageBtn">
                + Add Package
              </button>
            </div>
          </div>
        </div>

        <!-- SECTION 7 â€“ DIGITAL ASSETS -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingAssets">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAssets">
              SECTION 7 â€“ Digital Assets
            </button>
          </h2>
          <div id="collapseAssets" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
            <div class="accordion-body">
              <p class="small-help mb-2">
                Primary Image (max 1), Additional Images (max 3), LineArt, PDF. Images: JPG/JPEG/PNG/WEBP only.
              </p>
              <div id="assetsContainer"></div>
              <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addAssetBtn">
                + Add Digital Asset
              </button>
            </div>
          </div>
        </div>

        <!-- SECTION 8 â€“ PRICING -->
<div class="accordion-item">
  <h2 class="accordion-header" id="headingPricing">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePricing">
      SECTION 8 â€“ Pricing
    </button>
  </h2>
  <div id="collapsePricing" class="accordion-collapse collapse" data-bs-parent="#singleProductAccordion">
    <div class="accordion-body">

      <div class="border rounded p-3">
        <div class="section-heading mb-2">Pricing Levels</div>
        <p class="small-help mb-2">
          Add one or more pricing levels (Each / Case / Pallet / Bulk). Each level has its own pricing method.
        </p>

        <div id="priceLevelsContainer"></div>

        <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="addPriceLevelBtn">
          + Add Price Level
        </button>
      </div>

    </div>
  </div>
</div>
 <!-- /accordion -->

      <!-- Action Buttons -->
      <div class="d-flex flex-column flex-md-row gap-2 mt-3">
        <button type="submit" name="action" value="add" class="btn btn-secondary w-100 w-md-50">
          âž• Add Product to Batch
        </button>
        <button type="submit" name="action" value="generate" class="btn btn-primary w-100 w-md-50">
          ðŸ“Š Generate Excel for All Products
        </button>
      </div>

      <div class="text-center mt-3">
        <a href="{{ url_for('upload_page') }}" class="text-decoration-none">â¬… Back to Bulk Upload Portal</a>
      </div>

      {% if pending_products %}
        <hr class="my-4">
        <h5>Products Pending in Batch:</h5>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Vendor</th>
                <th>Status</th>
                <th>Pricing Method</th>
              </tr>
            </thead>
            <tbody>
              {% for p in pending_products %}
                <tr>
                  <td>{{ p.get("sku") }}</td>
                  <td>{{ p.get("vendor_name") }}</td>
                  <td>{{ p.get("product_status") }}</td>
                  <td>{{ p.get("pricing_method") }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}

      {% if latest_excel_available %}
        <div class="mt-3 text-center">
          <a href="{{ url_for('download_single_products_excel') }}" class="btn btn-outline-primary">
            â¬‡ Download Last Generated Excel
          </a>
        </div>
      {% endif %}

    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Helper to hook up generic remove buttons
  function attachRemove(block) {
    const btn = block.querySelector('.remove-block');
    if (!btn) return;
    btn.addEventListener('click', () => {
      block.remove();
    });
  }

  // --- Section 2: Descriptions ---
  const descriptionsContainer = document.getElementById('descriptionsContainer');
  document.getElementById('addDescriptionBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-2';
    block.innerHTML = `
      <div class="row">
        <div class="col-md-2 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="desc_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Description Code</label>
          <select class="form-select" name="desc_code[]">
            <option value="">-- Select --</option>
            <option value="DES">DES</option>
            <option value="SHO">SHO</option>
            <option value="MKT">MKT</option>
            <option value="FAB">FAB</option>
            <option value="ETC">ETC</option>
          </select>
        </div>
        <div class="col-md-4 mb-2">
          <label class="form-label">Description Value</label>
          <input type="text" class="form-control" name="desc_value[]" maxlength="255">
        </div>
        <div class="col-md-1 mb-2">
          <label class="form-label">Seq</label>
          <input type="number" class="form-control" name="desc_sequence[]" min="1">
        </div>
        <div class="col-md-2 mb-2">
          <label class="form-label">Language</label>
          <select class="form-select" name="desc_language[]">
            <option value="EN" selected>EN</option>
            <option value="FR">FR</option>
            <option value="ES">ES</option>
          </select>
        </div>
      </div>
      <button type="button" class="btn btn-link p-0 small text-danger remove-block">Remove</button>
    `;
    descriptionsContainer.appendChild(block);
    attachRemove(block);
  });

  // --- Section 3: Extended Info ---
  const extendedInfoContainer = document.getElementById('extendedInfoContainer');
  document.getElementById('addExtendedInfoBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-2';
    block.innerHTML = `
      <div class="row">
        <div class="col-md-3 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="ext_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Info Code</label>
          <select class="form-select ext-code-select" name="ext_code[]">
            <option value="">-- Select --</option>
            <option value="COO">COO</option>
            <option value="HSB">HSB</option>
            <option value="LIF">LIF</option>
            <option value="LIS">LIS</option>
            <option value="MSR">MSR</option>
            <option value="NPC">NPC</option>
            <option value="PLC">PLC</option>
            <option value="PLM">PLM</option>
            <option value="TAX">TAX</option>
          </select>
        </div>
        <div class="col-md-6 mb-2">
          <label class="form-label">Info Value</label>
          <input type="text" class="form-control ext-value-input" name="ext_value[]">
          <div class="small-help ext-hsb-hint d-none">HSB should be exactly 10 digits.</div>
        </div>
      </div>
      <button type="button" class="btn btn-link p-0 small text-danger remove-block">Remove</button>
    `;
    extendedInfoContainer.appendChild(block);
    attachRemove(block);

    const codeSelect = block.querySelector('.ext-code-select');
    const valueInput = block.querySelector('.ext-value-input');
    const hsbHint = block.querySelector('.ext-hsb-hint');

    codeSelect.addEventListener('change', () => {
      if (codeSelect.value === 'HSB') {
        hsbHint.classList.remove('d-none');
      } else {
        hsbHint.classList.add('d-none');
      }
    });
  });

  // --- Section 4: Attributes ---
  const attributesContainer = document.getElementById('attributesContainer');
  document.getElementById('addAttributeBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-2';
    block.innerHTML = `
      <div class="row">
        <div class="col-md-2 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="attr_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="col-md-4 mb-2">
          <label class="form-label">Attribute Name</label>
          <input type="text" class="form-control" name="attr_name[]">
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Attribute Unit</label>
          <select class="form-select" name="attr_unit[]">
            <option value="">-- Optional --</option>
            <option value="IN">IN</option>
            <option value="MM">MM</option>
            <option value="CM">CM</option>
            <option value="LB">LB</option>
            <option value="KG">KG</option>
            <option value="PSI">PSI</option>
            <option value="L">L</option>
            <option value="ML">ML</option>
            <option value="WATT">WATT</option>
          </select>
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Attribute Value</label>
          <input type="number" step="any" class="form-control" name="attr_value[]">
        </div>
      </div>
      <button type="button" class="btn btn-link p-0 small text-danger remove-block">Remove</button>
    `;
    attributesContainer.appendChild(block);
    attachRemove(block);
  });

  // --- Section 5: Part Interchange ---
  const interchangeContainer = document.getElementById('interchangeContainer');
  document.getElementById('addInterchangeBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-2';
    block.innerHTML = `
      <div class="row">
        <div class="col-md-2 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="int_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Brand Label</label>
          <input type="text" class="form-control" name="int_brand_label[]">
        </div>
        <div class="col-md-3 mb-2">
          <label class="form-label">Part Number</label>
          <input type="text" class="form-control" name="int_part_number[]">
        </div>
        <div class="col-md-4 mb-2">
          <label class="form-label">Interchange Quality</label>
          <select class="form-select" name="int_quality[]">
            <option value="">-- Select --</option>
            <option value="A">A â€“ Exact</option>
            <option value="B">B â€“ Good</option>
            <option value="C">C â€“ Compatible</option>
            <option value="S">S â€“ Superseded</option>
          </select>
        </div>
      </div>
      <button type="button" class="btn btn-link p-0 small text-danger remove-block">Remove</button>
    `;
    interchangeContainer.appendChild(block);
    attachRemove(block);
  });

  // --- Section 6: Packages ---
  const packagesContainer = document.getElementById('packagesContainer');
  document.getElementById('addPackageBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-2';
    block.innerHTML = `
      <div class="row">

        <!-- Change Type -->
        <div class="col-md-2 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="pack_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>

        <!-- Package UOM -->
        <div class="col-md-2 mb-2">
          <label class="form-label">Package UOM</label>
          <select class="form-select" name="pack_uom[]">
            <option value="">-- Select --</option>
            {% for u in PACKAGE_UOM %}
              <option value="{{ u }}">{{ u }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Quantity of Eaches -->
        <div class="col-md-2 mb-2">
          <label class="form-label">Quantity of Eaches</label>
          <input type="text" class="form-control" name="pack_qty_each[]">
        </div>

        <!-- Weight UOM -->
        <div class="col-md-2 mb-2">
          <label class="form-label">Weight UOM</label>
          <select class="form-select" name="pack_weight_uom[]">
            <option value="">-- Select --</option>
            {% for w in WEIGHT_UOM %}
              <option value="{{ w }}">{{ w }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Weight -->
        <div class="col-md-2 mb-2">
          <label class="form-label">Weight</label>
          <input type="text" class="form-control" name="pack_weight[]">
        </div>

      </div>

      <!-- ================= DIMENSIONS SECTION ================= -->

      <div class="row">
        <h6 class="mt-3 fw-bold">Shipping/Merchandising Dimensions</h6>

        <!-- ONE Dimension UOM -->
        <div class="col-md-2 mb-2">
          <label class="form-label">Dimension UOM</label>
          <select class="form-select" name="pack_dim_uom[]">
            <option value="">-- Select --</option>
            {% for d in DIMENSION_UOM %}
              <option value="{{ d }}">{{ d }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- Merchandising Dimensions -->
      <div class="row">
        <div class="col-md-2 mb-2">
          <label class="form-label">Merch Length</label>
          <input type="text" class="form-control" name="pack_merch_length[]">
        </div>

        <div class="col-md-2 mb-2">
          <label class="form-label">Merch Width</label>
          <input type="text" class="form-control" name="pack_merch_width[]">
        </div>

        <div class="col-md-2 mb-2">
          <label class="form-label">Merch Height</label>
          <input type="text" class="form-control" name="pack_merch_height[]">
        </div>
      </div>

      <!-- Shipping Dimensions -->
      <div class="row">
        <div class="col-md-2 mb-2">
          <label class="form-label">Ship Length</label>
          <input type="text" class="form-control" name="pack_ship_length[]">
        </div>

        <div class="col-md-2 mb-2">
          <label class="form-label">Ship Width</label>
          <input type="text" class="form-control" name="pack_ship_width[]">
        </div>

        <div class="col-md-2 mb-2">
          <label class="form-label">Ship Height</label>
          <input type="text" class="form-control" name="pack_ship_height[]">
        </div>
      </div>

      <button type="button" class="btn btn-link p-0 small text-danger remove-block">Remove</button>
    `;
    packagesContainer.appendChild(block);
    attachRemove(block);
  });

  // --- Section 7: Digital Assets ---
  const assetsContainer = document.getElementById('assetsContainer');
  let primaryImageCount = 0;
  let additionalImageCount = 0;

  function canAddMediaType(type) {
    if (type === 'PrimaryImage' && primaryImageCount >= 1) {
      alert('Only 1 Primary Image allowed.');
      return false;
    }
    if (type === 'AdditionalImage' && additionalImageCount >= 3) {
      alert('Maximum 3 Additional Images allowed.');
      return false;
    }
    return true;
  }

  document.getElementById('addAssetBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-2 asset-block';
    block.innerHTML = `
      <div class="row align-items-end">
        <div class="col-md-3 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select asset-change-type" name="asset_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="col-md-4 mb-2">
          <label class="form-label">Media Type</label>
          <select class="form-select asset-media-type" name="asset_media_type[]">
            <option value="">-- Select --</option>
            <option value="PrimaryImage">Primary Image</option>
            <option value="AdditionalImage">Additional Image</option>
            <option value="LineArt">LineArt</option>
            <option value="PDF">PDF</option>
          </select>
        </div>
        <div class="col-md-5 mb-2">
          <label class="form-label">Browse and Upload</label>
          <input type="file" class="form-control asset-file-input" name="asset_file[]" accept="image/*">
        </div>
      </div>
      <button type="button" class="btn btn-link p-0 small text-danger remove-block">Remove</button>
    `;
    assetsContainer.appendChild(block);
    attachRemove(block);

    const mediaSelect = block.querySelector('.asset-media-type');
    const fileInput = block.querySelector('.asset-file-input');

    mediaSelect.addEventListener('change', () => {
      const type = mediaSelect.value;
      if (!type) return;

      if (!canAddMediaType(type)) {
        mediaSelect.value = '';
        return;
      }

      // Adjust counters
      if (type === 'PrimaryImage') primaryImageCount++;
      if (type === 'AdditionalImage') additionalImageCount++;

      // Accept rules
      if (type === 'PDF') {
        fileInput.accept = '.pdf';
      } else {
        fileInput.accept = 'image/*';
      }
    });

    const removeBtn = block.querySelector('.remove-block');
    removeBtn.addEventListener('click', () => {
      const type = mediaSelect.value;
      if (type === 'PrimaryImage') primaryImageCount = Math.max(0, primaryImageCount - 1);
      if (type === 'AdditionalImage') additionalImageCount = Math.max(0, additionalImageCount - 1);
    });
  });

    // --- Section 8: Pricing Levels ---
  const priceLevelsContainer = document.getElementById('priceLevelsContainer');

  document.getElementById('addPriceLevelBtn').addEventListener('click', () => {
    const block = document.createElement('div');
    block.className = 'border rounded p-3 mb-3';

    block.innerHTML = `
      <div class="row">
        <div class="col-md-2 mb-2">
          <label class="form-label">Level Type</label>
          <select class="form-select" name="level_type[]">
            <option value="">-- Select --</option>
            <option value="Each">Each</option>
            <option value="Case">Case</option>
            <option value="Pallet">Pallet</option>
            <option value="Bulk">Bulk</option>
          </select>
        </div>
        <div class="col-md-2 mb-2">
          <label class="form-label">Change Type</label>
          <select class="form-select" name="level_price_change_type[]">
            <option value="A" selected>A</option>
            <option value="M">M</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="col-md-2 mb-2">
          <label class="form-label">MOQ Unit</label>
          <select class="form-select" name="level_moq_uom[]">
            <option value="">-- Select --</option>
            {% for u in QUANTITY_UOM %}
              <option value="{{ u }}">{{ u }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2 mb-2">
          <label class="form-label">MOQ</label>
          <input type="text" class="form-control" name="level_moq_qty[]">
        </div>
        <div class="col-md-2 mb-2">
          <label class="form-label">Currency</label>
          <select class="form-select" name="level_currency[]">
            <option value="">-- Select --</option>
            <option value="CAD">CAD</option>
            <option value="USD">USD</option>
          </select>
        </div>
        <div class="col-md-2 mb-2">
          <label class="form-label">Pricing Method</label>
          <select class="form-select pricing-method-select" name="level_pricing_method[]">
            <option value="">-- Select --</option>
            <option value="net_cost">Net Cost Provided</option>
            <option value="price_levels">Price Levels Provided</option>
            <option value="discount_based">Discount-Based Pricing</option>
            <option value="ehc_based">EHC-Based Pricing</option>
            <option value="promo_pricing">Promo Pricing</option>
            <option value="quote_pricing">Quote Pricing</option>
            <option value="tender_pricing">Tender Pricing</option>
            <option value="core_pricing">Core Pricing</option>
          </select>
        </div>
      </div>

      <!-- Method: Net Cost -->
      <div class="method-fields method-net_cost d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Net Cost Provided</div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label class="form-label">List Price</label>
            <input type="text" class="form-control" name="level_net_list_price[]">
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label">Net Cost</label>
            <input type="text" class="form-control" name="level_net_net_cost[]">
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label">Effective Date</label>
            <input type="date" class="form-control" name="level_net_effective_date[]">
          </div>
        </div>
      </div>

      <!-- Method: Price Levels Provided -->
      <div class="method-fields method-price_levels d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Price Levels Provided</div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">List Price</label>
            <input type="text" class="form-control" name="level_pl_list_price[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Jobber Price</label>
            <input type="text" class="form-control" name="level_pl_jobber_price[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Net Cost</label>
            <input type="text" class="form-control" name="level_pl_net_cost[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Effective Date</label>
            <input type="date" class="form-control" name="level_pl_effective_date[]">
          </div>
        </div>
      </div>

      <!-- Method: Discount-Based Pricing -->
      <div class="method-fields method-discount_based d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Discount-Based Pricing</div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">Base Price</label>
            <input type="text" class="form-control" name="level_db_base_price[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Discount % (0â€“1)</label>
            <input type="text" class="form-control" name="level_db_discount_pct[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Optional List Price</label>
            <input type="text" class="form-control" name="level_db_list_price_opt[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Effective Date</label>
            <input type="date" class="form-control" name="level_db_effective_date[]">
          </div>
        </div>
      </div>

      <!-- Method: EHC-Based Pricing -->
      <div class="method-fields method-ehc_based d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">EHC-Based Pricing (Baldwin-style)</div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">Base Price (Canadian Blue)</label>
            <input type="text" class="form-control" name="level_ehc_base_price[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Canadian Blue</label>
            <input type="text" class="form-control" name="level_ehc_canadian_blue[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Qty / Case</label>
            <input type="text" class="form-control" name="level_ehc_qty_case[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Packaging MOQ</label>
            <input type="text" class="form-control" name="level_ehc_moq[]">
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label class="form-label">UPC Each</label>
            <input type="text" class="form-control" name="level_ehc_upc_each[]">
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label">UPC Case</label>
            <input type="text" class="form-control" name="level_ehc_upc_case[]">
          </div>
        </div>

        <div class="small-help mb-1 mt-2">EHC fees (Each / Case):</div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">AB / MB / SK â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_abmbsk_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">AB / MB / SK â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_abmbsk_case[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">BC â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_bc_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">BC â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_bc_case[]">
          </div>
        </div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">NL â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_nl_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">NL â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_nl_case[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">NS â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_ns_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">NS â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_ns_case[]">
          </div>
        </div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">NB / QC â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_nbqc_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">NB / QC â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_nbqc_case[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">PEI â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_pei_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">PEI â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_pei_case[]">
          </div>
        </div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">YK â€“ Each</label>
            <input type="text" class="form-control" name="level_ehc_yk_each[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">YK â€“ Case</label>
            <input type="text" class="form-control" name="level_ehc_yk_case[]">
          </div>
        </div>
      </div>

      <!-- Method: Promo Pricing -->
      <div class="method-fields method-promo_pricing d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Promo Pricing</div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label class="form-label">Promo Price</label>
            <input type="text" class="form-control" name="level_pr_promo_price[]">
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label">Promo Start Date</label>
            <input type="date" class="form-control" name="level_pr_start_date[]">
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label">Promo End Date</label>
            <input type="date" class="form-control" name="level_pr_end_date[]">
          </div>
        </div>
      </div>

      <!-- Method: Quote Pricing -->
      <div class="method-fields method-quote_pricing d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Quote Pricing</div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">Quote Price</label>
            <input type="text" class="form-control" name="level_qt_price[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Quote Number (optional)</label>
            <input type="text" class="form-control" name="level_qt_number[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Quote Start Date</label>
            <input type="date" class="form-control" name="level_qt_start_date[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Quote End Date</label>
            <input type="date" class="form-control" name="level_qt_end_date[]">
          </div>
        </div>
      </div>

      <!-- Method: Tender Pricing -->
      <div class="method-fields method-tender_pricing d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Tender Pricing</div>
        <div class="row">
          <div class="col-md-3 mb-2">
            <label class="form-label">Tender Price</label>
            <input type="text" class="form-control" name="level_td_price[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Tender Number (optional)</label>
            <input type="text" class="form-control" name="level_td_number[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label"> Tender Start Date</label>
            <input type="date" class="form-control" name="level_td_start_date[]">
          </div>
          <div class="col-md-3 mb-2">
            <label class="form-label">Tender End Date</label>
            <input type="date" class="form-control" name="level_td_end_date[]">
          </div>
        </div>
      </div>

           <!-- Method: Core Cost -->
      <div class="method-fields method-core_pricing d-none border-top pt-2 mt-2">
        <div class="section-heading mb-2">Core Pricing</div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label class="form-label">Core Price</label>
            <input type="text" class="form-control" name="level_core_list_price[]">
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label">Core Part Number</label>
            <input type="text" class="form-control" name="level_core_part_number[]">
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-link p-0 mt-2 small text-danger remove-block">
        Remove Pricing Level
      </button>
    `;

    priceLevelsContainer.appendChild(block);
    attachRemove(block);

    const methodSelect = block.querySelector('.pricing-method-select');
    const methodSections = block.querySelectorAll('.method-fields');

    methodSelect.addEventListener('change', () => {
      const val = methodSelect.value;
      methodSections.forEach(sec => sec.classList.add('d-none'));
      if (!val) return;
      const target = block.querySelector('.method-' + val);
      if (target) target.classList.remove('d-none');
    });
  });

</script>

</body>
</html>
